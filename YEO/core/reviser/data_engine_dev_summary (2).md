# ğŸ“˜ Data Engine ê°œë°œ ë° ì…ì¶œë ¥ êµ¬ì¡° ì •ë¦¬

ì´ ë¬¸ì„œëŠ” **Module B (Data Engine)** ê°œë°œ ê³¼ì •ì„ ìš”ì•½í•˜ê³ , ì½”ë“œ ì„¤ê³„, ì…ë ¥/ì¶œë ¥ êµ¬ì¡°ë¥¼ PMê³¼ ë‹¤ìŒ GPT ì±„íŒ…ë°©ì—ì„œ ì‰½ê²Œ ì´í•´í•  ìˆ˜ ìˆë„ë¡ ì •ë¦¬í•œ ê²ƒì…ë‹ˆë‹¤.

---

## 1. ê°œë°œ ì§„í–‰ ê°œìš”

1. **IntentResolver ëª¨ë“ˆ (Module A)**

   - ì‚¬ìš©ì ìì—°ì–´ ì§ˆì˜ë¥¼ ë°›ì•„ ê¸°ê°„(JSON)ìœ¼ë¡œ ë³€í™˜.
   - ì˜ˆ: `"ì €ë²ˆì£¼ ê°ì • ìš”ì•½ ë³´ì—¬ì¤˜"` â†’
     ```json
     {
       "mode": "weekly",
       "date": null,
       "start": "2025-08-18",
       "end": "2025-08-24",
       "source": "ì €ë²ˆì£¼ ê°ì • ìš”ì•½ ë³´ì—¬ì¤˜",
       "timezone": "Asia/Seoul"
     }
     ```
   - Data Engineì˜ ì…ë ¥ìœ¼ë¡œ ë°”ë¡œ ì‚¬ìš©.

2. **Data Engine (Module B)**

   - 3ë‹¨ê³„ êµ¬ì„±: **Scanner â†’ Normalizer â†’ Aggregator**
   - ì—­í• :
     - ì§€ì •ëœ ê¸°ê°„ ì•ˆì˜ `analysis_result_*.json` íŒŒì¼ ìˆ˜ì§‘
     - ê°ì • ë¶„í¬ë¥¼ 7ê°ì • í’€ì…‹ìœ¼ë¡œ ì •ê·œí™”
     - ì¼ê°„ ì¹´ë“œì™€ ê¸°ê°„ ë¦¬í¬íŠ¸ ì§‘ê³„

3. **Summarizer & Export (Module C)**

   - Data Engine ì¶œë ¥(JSON)ì„ ë°›ì•„ ìš”ì•½ ë¬¸êµ¬ ìƒì„±, íŒŒì¼ ì €ì¥/DB ë§¤í•‘.
   - ì´ ë°©ì—ì„œëŠ” ì•„ì§ ë³¸ê²© êµ¬í˜„ ì „, Data Engineê¹Œì§€ ì§‘ì¤‘.

---

## 2. Data Engine ìƒì„¸ ì„¤ê³„

### (1) Scanner

- **ì…ë ¥ ì˜ˆì‹œ**: date\_range = {

  Â  Â  "mode": "weekly",

  Â  Â  "date": None,

  Â  Â  "start": "2025-08-18",

  Â  Â  "end": "2025-08-26",

  Â  Â  "source": "ì €ë²ˆì£¼ì¸ê°€ ì¼ì´ ë§ì•„ì„œ ìš°ìš¸í–ˆë˜ê±° ê°™ì€ë° ì–´ë• ë”ë¼?"

  }
- **ì²˜ë¦¬**: ê¸°ê°„ ì•ˆì˜ íŒŒì¼ ìŠ¤ìº”, íŒŒì¼ëª…ì—ì„œ ë‚ ì§œ ì¶”ì¶œ
- **ì¶œë ¥ êµ¬ì¡°**:
  ```python
  files = {
    "2025-08-23": [Path(".../analysis_result_20250823_050448.json"), ...],
    "2025-08-24": [Path(".../analysis_result_20250824_091200.json")]
  }
  ```

### (2) Normalizer

- **ì…ë ¥**: ê°œë³„ `analysis_result_*.json`
- **ì²˜ë¦¬**:
  - ì£¼ìš” í•„ë“œ ì¶”ì¶œ: `sentiment_score`, `dominant_overall_emotion`, `emotion_distribution`
  - Top-K ê°ì •ë§Œ ë“¤ì–´ì˜¨ ë¶„í¬ â†’ **7ê°ì • í’€ì…‹**ìœ¼ë¡œ í™•ì¥ (`ì—†ëŠ” ê°ì •=0`, í•©=1ë¡œ ì •ê·œí™”)
- **ì¶œë ¥ êµ¬ì¡°**:
  ```python
  {
    "score": 60,  # sentiment_score
    "top": "ê¸°ì¨", # dominant_overall_emotion
    "dist": {"ê¸°ì¨":0.45, "ì¤‘ë¦½":0.30, "ìŠ¬í””":0.25, "ë¶„ë…¸":0, "ë¶ˆì•ˆ":0, "ìƒì²˜":0, "ë‹¹í™©":0}
  }
  ```

### (3) Aggregator

#### A. Daily Aggregator

- **ì…ë ¥**: í•˜ë£¨ì— í•´ë‹¹í•˜ëŠ” íŒŒì¼ ë¦¬ìŠ¤íŠ¸ (NormalizedRecord[])
- **ì§‘ê³„ ê·œì¹™**:
  - ì ìˆ˜ = **í‰ê· (mean)** (ì¤‘ì•™ê°’ â†’ í‰ê· ìœ¼ë¡œ ë³€ê²½)
  - ì£¼ê°ì • = **ë‹¤ìˆ˜ê²°** (ë™ë¥  â†’ ì¶”í›„ ì—°ì†ì„± ê³ ë ¤ ê°€ëŠ¥)
  - ë¶„í¬ = **í•©ì‚° í›„ ì •ê·œí™”**
- **ì¶œë ¥ êµ¬ì¡° (DailyCardJSON)**:
  ```python
  daily_cards = {
    "2025-08-23": {"score": 63, "top": "ê¸°ì¨", "dist": {...}},
    "2025-08-24": {"score": 58, "top": "ë¶ˆì•ˆ", "dist": {...}}
  }
  ```

#### B. Period Aggregator

- **ì…ë ¥**: ì—¬ëŸ¬ ì¼ê°„ ì¹´ë“œ
- **ì§‘ê³„ ê·œì¹™**:
  - í‰ê·  ì ìˆ˜ (ì •ìˆ˜ ë°˜ì˜¬ë¦¼)
  - ìš°ì„¸ ê°ì • Top-K ë¹ˆë„ ê³„ì‚°
  - trend: ë‚ ì§œë³„ score/top ëª©ë¡
  - notable\_changes:
    - Î”score â‰¥ 10 â†’ ì ìˆ˜ ê¸‰ë³€ ì´ë²¤íŠ¸
    - dominant ê°ì • ë³€í™” â†’ ê°ì • ì „í™˜ ì´ë²¤íŠ¸
- **ì¶œë ¥ êµ¬ì¡° (PeriodReportJSON)**:
  ```python
  period = {
    "average_sentiment_score": 36,
    "dominant_emotions": [
      {"emotion": "ìƒì²˜", "percentage": 0.5},
      {"emotion": "ì¤‘ë¦½", "percentage": 0.25},
      {"emotion": "ê¸°ì¨", "percentage": 0.25}
    ],
    "trend": {
      "by_day": [
        {"date": "2025-08-18", "score": 20, "top": "ìƒì²˜"},
        {"date": "2025-08-21", "score": 35, "top": "ì¤‘ë¦½"},
        {"date": "2025-08-23", "score": 30, "top": "ìƒì²˜"},
        {"date": "2025-08-24", "score": 60, "top": "ê¸°ì¨"}
      ],
      "notable_changes": [
        {"date": "2025-08-21", "event": "ì ìˆ˜ ê¸‰ë³€", "delta": 15},
        {"date": "2025-08-21", "event": "ì£¼ê°ì • ì „í™˜: ìƒì²˜â†’ì¤‘ë¦½"},
        {"date": "2025-08-23", "event": "ì£¼ê°ì • ì „í™˜: ì¤‘ë¦½â†’ìƒì²˜"},
        {"date": "2025-08-24", "event": "ì ìˆ˜ ê¸‰ë³€", "delta": 30},
        {"date": "2025-08-24", "event": "ì£¼ê°ì • ì „í™˜: ìƒì²˜â†’ê¸°ì¨"}
      ]
    }
  }
  ```

---

## 3. ì…ë ¥ â†’ ì¶œë ¥ ì „ì²´ íë¦„

1. **Intent ëª¨ë“ˆ ì¶œë ¥** â†’ `date_range` JSON
2. **Scanner** â†’ ë‚ ì§œë³„ íŒŒì¼ dict
3. **Normalizer** â†’ íŒŒì¼ë³„ ì ìˆ˜/ê°ì • ë¶„í¬ í‘œì¤€í™”
4. **Aggregator** â†’
   - DailyCardJSON (ë‚ ì§œë³„ ì¹´ë“œ)
   - PeriodReportJSON (ê¸°ê°„ ë¦¬í¬íŠ¸)

---

## 4. ìš”ì•½

- **ì…ë ¥**: IntentResolverì˜ ê¸°ê°„ JSON + analysis\_result\_\*.json íŒŒì¼ë“¤
- **ì²˜ë¦¬**: Scanner â†’ Normalizer â†’ Aggregator
- **ì¶œë ¥**:
  - `daily_cards`: ë‚ ì§œë³„ ì ìˆ˜/ì£¼ê°ì •/ë¶„í¬
  - `period`: ê¸°ê°„ í‰ê· , ìš°ì„¸ê°ì • TopK, trend, notable\_changes

ì´ë¡œì¨ Data Engineì€ **ìì—°ì–´ ì§ˆì˜ â†’ ê¸°ê°„ ë°ì´í„° ìš”ì•½ JSON** ë³€í™˜ì˜ í•µì‹¬ ë£¨í”„ë¥¼ ì™„ì„±í–ˆìŠµë‹ˆë‹¤.

